- name: Instalar dependencias de Python
  apt:
    name:
      - python3
      - python3-pip
      - python3-venv
    state: present
    update_cache: yes

- name: Crear virtualenv para Prefect
  command: python3 -m venv /home/debian/.venv_prefect
  args:
    creates: /home/debian/.venv_prefect

- name: Asignar permisos al entorno virtual para el usuario debian
  file:
    path: /home/debian/.venv_prefect
    owner: debian
    group: debian
    recurse: yes

- name: Instalar Prefect en virtualenv
  command: >
    /home/debian/.venv_prefect/bin/pip install --upgrade pip &&
    /home/debian/.venv_prefect/bin/pip install "prefect==2.13.5"

- name: Verificar instalaciÃ³n de Prefect
  command: /home/debian/.venv_prefect/bin/prefect version
  register: prefect_version
- debug:
    msg: "Prefect version instalada: {{ prefect_version.stdout }}"
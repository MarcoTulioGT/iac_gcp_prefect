- name: Instalar dependencias de Python
  apt:
    name:
      - python3.10
      - python3.10-pip
      - python3.10-venv
    state: present
    update_cache: yes

- name: Crear virtualenv para Prefect 3.10
  command: python3.10 -m venv /home/debian/.venv_prefect
  args:
    creates: /home/debian/.venv_prefect

- name: Asignar permisos al entorno virtual para el usuario debian
  file:
    path: /home/debian/.venv_prefect
    owner: debian
    group: debian
    recurse: yes

- name: Instalar Prefect con todas sus dependencias
  shell: |
    source /home/debian/.venv_prefect/bin/activate && \
    pip install --upgrade pip && \
    pip install "prefect[dev]==2.13.5"
  args:
    executable: /bin/bash



- name: Verificar instalaci√≥n de Prefect
  shell: |
    source /home/debian/.venv_prefect/bin/activate && \
    prefect version
  args:
    executable: /bin/bash
  register: prefect_version

- debug:
    msg: "Prefect instalado: {{ prefect_version.stdout }}"
